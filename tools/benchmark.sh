#!/usr/bin/env sh
# SPDX-FileCopyrightText: 2025 Guilherme Leoi <leoi.guilherme@aluno.ufabc.edu.br>
#
# SPDX-License-Identifier: 0BSD OR CC0-1.0

sh ./tools/build_release.sh
sh ./tools/build_cuda.sh

COT_BASENAME="Low Angle View of Cat on Tree"
SEQUENTIAL_CAT_ON_TREE="sequential,$COT_BASENAME,7,180,1.25,1"
OPENMP_CAT_ON_TREE="openmp,$COT_BASENAME,7,180,1.25,4"
PTHREADS_CAT_ON_TREE="pthreads,$COT_BASENAME,7,180,1.25,4"
CUDA_CAT_ON_TREE="cuda,$COT_BASENAME,7,180,1.25,1"
COT="$SEQUENTIAL_CAT_ON_TREE;$OPENMP_CAT_ON_TREE;$PTHREADS_CAT_ON_TREE;$CUDA_CAT_ON_TREE;"

COTS_BASENAME="$COT_BASENAME (Small)"
SEQUENTIAL_CAT_ON_TREE_SMALL="sequential,$COTS_BASENAME,7,180,1.25,1"
OPENMP_CAT_ON_TREE_SMALL="openmp,$COTS_BASENAME,7,180,1.25,4"
PTHREADS_CAT_ON_TREE_SMALL="pthreads,$COTS_BASENAME,7,180,1.25,4"
CUDA_CAT_ON_TREE_SMALL="cuda,$COTS_BASENAME,7,180,1.25,1"
COTS="$SEQUENTIAL_CAT_ON_TREE_SMALL;$OPENMP_CAT_ON_TREE_SMALL;$PTHREADS_CAT_ON_TREE_SMALL;$CUDA_CAT_ON_TREE_SMALL;"

COTM_BASENAME="$COT_BASENAME (Medium)"
SEQUENTIAL_CAT_ON_TREE_MEDIUM="sequential,$COTM_BASENAME,7,180,1.25,1"
OPENMP_CAT_ON_TREE_MEDIUM="openmp,$COTM_BASENAME,7,180,1.25,4"
PTHREADS_CAT_ON_TREE_MEDIUM="pthreads,$COTM_BASENAME,7,180,1.25,4"
CUDA_CAT_ON_TREE_MEDIUM="cuda,$COTM_BASENAME,7,180,1.25,1"
COTM="$SEQUENTIAL_CAT_ON_TREE_MEDIUM;$OPENMP_CAT_ON_TREE_MEDIUM;$PTHREADS_CAT_ON_TREE_MEDIUM;$CUDA_CAT_ON_TREE_MEDIUM;"

COTL_BASENAME="$COT_BASENAME (Large)"
SEQUENTIAL_CAT_ON_TREE_LARGE="sequential,$COTL_BASENAME,7,180,1.25,1"
OPENMP_CAT_ON_TREE_LARGE="openmp,$COTL_BASENAME,7,180,1.25,4"
PTHREADS_CAT_ON_TREE_LARGE="pthreads,$COTL_BASENAME,7,180,1.25,4"
CUDA_CAT_ON_TREE_LARGE="cuda,$COTL_BASENAME,7,180,1.25,1"
COTL="$SEQUENTIAL_CAT_ON_TREE_LARGE;$OPENMP_CAT_ON_TREE_LARGE;$PTHREADS_CAT_ON_TREE_LARGE;$CUDA_CAT_ON_TREE_LARGE;"

ALL="$COTS$COTM$COTL$COT"
while IFS=',' read -d';' -r VARIANT SOURCE M_PARAM THRESHOLD SHARPEN_FACTOR P_COUNT; do
    echo "$VARIANT on file \"$SOURCE\": m=$M_PARAM T=$THRESHOLD Î±=$SHARPEN_FACTOR"
    for P in $(seq 1 $P_COUNT); do
        echo "P=$P"
        for N in $(seq 1 30); do
            time -f "%e" ./tools/run.sh $VARIANT "./inputs/$SOURCE.ppm" $M_PARAM $THRESHOLD $SHARPEN_FACTOR $P
        done
    done
done <<< "$ALL"
